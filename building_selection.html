<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختيار المبنى السكني - جامعة نجران</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark-mode');
        }
    </script>

    <!-- الهيدر -->
    <header class="simple-header">
        <div class="header-content">
            <img src="assets/images/university-logo.png" alt="شعار جامعة نجران" class="logo">
            <h1>اختيار المبنى السكني</h1>
            <p>اختر المبنى المناسب حسب توفر الغرف ونوع السكن</p>
        </div>
    </header>

    <main class="building-selection-container">
        <div class="container">
            <!-- معلومات الطالب -->
            <div class="student-info-card">
                <h3><i class="icon-user"></i> بيانات الطالب</h3>
                <div class="student-details" id="studentDetails">
                    <!-- سيتم ملؤها بواسطة JavaScript -->
                </div>
                <div class="priority-badge" id="priorityBadge">
                    <i class="icon-star"></i>
                    <span>جاري حساب أولويتك...</span>
                </div>
            </div>

            <!-- اختيار المباني للطلاب الذكور -->
            <section id="maleBuildings" class="buildings-section">
                <h2><i class="icon-building"></i> مباني سكن الطلاب (ذكور)</h2>
                <p class="section-subtitle">اختر أحد المباني التالية حسب رغبتك وتوفر الغرف</p>
                
                <div class="buildings-grid">
                    <div class="building-card">
                        <div class="building-header">
                            <h3>المبنى (أ)</h3>
                            <span class="building-status available">متاح</span>
                        </div>
                        <div class="building-image">
                            <img src="assets/images/building-a.jpg" alt="المبنى أ">
                        </div>
                        <div class="building-info">
                            <p><i class="icon-bed"></i> نوع الغرف: فردية</p>
                            <p><i class="icon-users"></i> السعة: 200 طالب</p>
                            <p><i class="icon-check"></i> متوفر: 45 غرفة</p>
                            <p><i class="icon-star"></i> التجهيزات: مكيف، إنترنت، ثلاجة</p>
                        </div>
                        <div class="occupancy-meter">
                            <div class="meter-label">نسبة الإشغال</div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: 65%"></div>
                            </div>
                            <span class="meter-text">65%</span>
                        </div>
                        <button class="btn-select-building" data-building="A" data-gender="male">
                            <i class="icon-check-circle"></i> اختيار هذا المبنى
                        </button>
                    </div>
                    
                    <div class="building-card">
                        <div class="building-header">
                            <h3>المبنى (ب)</h3>
                            <span class="building-status limited">محدود</span>
                        </div>
                        <div class="building-image">
                            <img src="assets/images/building-b.jpg" alt="المبنى ب">
                        </div>
                        <div class="building-info">
                            <p><i class="icon-bed"></i> نوع الغرف: مزدوجة</p>
                            <p><i class="icon-users"></i> السعة: 300 طالب</p>
                            <p><i class="icon-check"></i> متوفر: 12 غرفة</p>
                            <p><i class="icon-star"></i> التجهيزات: مكيف، إنترنت، مطبخ مشترك</p>
                        </div>
                        <div class="occupancy-meter">
                            <div class="meter-label">نسبة الإشغال</div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: 88%"></div>
                            </div>
                            <span class="meter-text">88%</span>
                        </div>
                        <button class="btn-select-building" data-building="B" data-gender="male">
                            <i class="icon-check-circle"></i> اختيار هذا المبنى
                        </button>
                    </div>
                    
                    <div class="building-card">
                        <div class="building-header">
                            <h3>المبنى (ج)</h3>
                            <span class="building-status full">شبه ممتلئ</span>
                        </div>
                        <div class="building-image">
                            <img src="assets/images/building-c.jpg" alt="المبنى ج">
                        </div>
                        <div class="building-info">
                            <p><i class="icon-bed"></i> نوع الغرف: ثلاثية</p>
                            <p><i class="icon-users"></i> السعة: 400 طالب</p>
                            <p><i class="icon-check"></i> متوفر: 5 غرف</p>
                            <p><i class="icon-star"></i> التجهيزات: مكيف، إنترنت، صالة ألعاب</p>
                        </div>
                        <div class="occupancy-meter">
                            <div class="meter-label">نسبة الإشغال</div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: 95%"></div>
                            </div>
                            <span class="meter-text">95%</span>
                        </div>
                        <button class="btn-select-building" data-building="C" data-gender="male">
                            <i class="icon-check-circle"></i> اختيار هذا المبنى
                        </button>
                    </div>
                </div>
            </section>

            <!-- اختيار المباني للطالبات -->
            <section id="femaleBuildings" class="buildings-section" style="display: none;">
                <h2><i class="icon-building"></i> مباني سكن الطالبات (إناث)</h2>
                <p class="section-subtitle">اختر أحد المباني التالية حسب رغبتك وتوفر الغرف</p>
                
                <div class="buildings-grid">
                    <div class="building-card">
                        <div class="building-header">
                            <h3>المبنى (١)</h3>
                            <span class="building-status available">متاح</span>
                        </div>
                        <div class="building-image">
                            <img src="assets/images/building-1.jpg" alt="المبنى 1">
                        </div>
                        <div class="building-info">
                            <p><i class="icon-bed"></i> نوع الغرف: فردية</p>
                            <p><i class="icon-users"></i> السعة: 180 طالبة</p>
                            <p><i class="icon-check"></i> متوفر: 60 غرفة</p>
                            <p><i class="icon-star"></i> التجهيزات: مكيف، إنترنت، ثلاجة</p>
                        </div>
                        <div class="occupancy-meter">
                            <div class="meter-label">نسبة الإشغال</div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: 55%"></div>
                            </div>
                            <span class="meter-text">55%</span>
                        </div>
                        <button class="btn-select-building" data-building="1" data-gender="female">
                            <i class="icon-check-circle"></i> اختيار هذا المبنى
                        </button>
                    </div>
                    
                    <div class="building-card">
                        <div class="building-header">
                            <h3>المبنى (٢)</h3>
                            <span class="building-status limited">محدود</span>
                        </div>
                        <div class="building-image">
                            <img src="assets/images/building-2.jpg" alt="المبنى 2">
                        </div>
                        <div class="building-info">
                            <p><i class="icon-bed"></i> نوع الغرف: مزدوجة</p>
                            <p><i class="icon-users"></i> السعة: 250 طالبة</p>
                            <p><i class="icon-check"></i> متوفر: 25 غرفة</p>
                            <p><i class="icon-star"></i> التجهيزات: مكيف، إنترنت، مطبخ مشترك</p>
                        </div>
                        <div class="occupancy-meter">
                            <div class="meter-label">نسبة الإشغال</div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: 78%"></div>
                            </div>
                            <span class="meter-text">78%</span>
                        </div>
                        <button class="btn-select-building" data-building="2" data-gender="female">
                            <i class="icon-check-circle"></i> اختيار هذا المبنى
                        </button>
                    </div>
                    
                    <div class="building-card">
                        <div class="building-header">
                            <h3>المبنى (٣)</h3>
                            <span class="building-status full">شبه ممتلئ</span>
                        </div>
                        <div class="building-image">
                            <img src="assets/images/building-3.jpg" alt="المبنى 3">
                        </div>
                        <div class="building-info">
                            <p><i class="icon-bed"></i> نوع الغرف: ثلاثية</p>
                            <p><i class="icon-users"></i> السعة: 320 طالبة</p>
                            <p><i class="icon-check"></i> متوفر: 8 غرفة</p>
                            <p><i class="icon-star"></i> التجهيزات: مكيف، إنترنت، صالة ألعاب</p>
                        </div>
                        <div class="occupancy-meter">
                            <div class="meter-label">نسبة الإشغال</div>
                            <div class="meter-bar">
                                <div class="meter-fill" style="width: 92%"></div>
                            </div>
                            <span class="meter-text">92%</span>
                        </div>
                        <button class="btn-select-building" data-building="3" data-gender="female">
                            <i class="icon-check-circle"></i> اختيار هذا المبنى
                        </button>
                    </div>
                </div>
            </section>

            <!-- تأكيد الاختيار -->
            <div class="selection-confirmation" id="selectionConfirmation" style="display: none;">
                <div class="confirmation-card">
                    <h3><i class="icon-check-circle"></i> تأكيد اختيار المبنى</h3>
                    <div class="selected-building-info" id="selectedBuildingInfo">
                        <!-- سيتم ملؤها بواسطة JavaScript -->
                    </div>
                    <div class="confirmation-actions">
                        <button id="confirmSelection" class="btn-primary btn-large">
                            <i class="icon-check"></i> تأكيد الاختيار والمتابعة
                        </button>
                        <button id="changeSelection" class="btn-secondary">
                            <i class="icon-edit"></i> تغيير الاختيار
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- الفوتر -->
    <footer class="simple-footer">
        <p>© 2024 نظام حجز السكن الجامعي - جامعة نجران</p>
        <p>رقم الدعم الفني: 0175432100 | البريد: housing@nu.edu.sa</p>
    </footer>

    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // الحصول على بيانات الطالب من localStorage
            const studentData = JSON.parse(localStorage.getItem('currentStudent'));
            
            if (!studentData) {
                alert('الرجاء التسجيل أولاً');
                window.location.href = 'login.html';
                return;
            }
            
            // عرض بيانات الطالب
            document.getElementById('studentDetails').innerHTML = `
                <p><strong>الاسم:</strong> ${studentData.fullName}</p>
                <p><strong>المعدل:</strong> ${studentData.gpa}</p>
                <p><strong>المحافظة:</strong> ${studentData.province}</p>
                <p><strong>التخصص:</strong> ${studentData.specialization}</p>
            `;
            
            // حساب الأولوية
            const priorityScore = calculatePriorityScore(studentData.gpa, studentData.province);
            const priorityBadge = document.getElementById('priorityBadge');
            
            if (priorityScore >= 80) {
                priorityBadge.innerHTML = '<i class="icon-star"></i><span>أولوية عالية</span>';
                priorityBadge.className = 'priority-badge high';
            } else if (priorityScore >= 60) {
                priorityBadge.innerHTML = '<i class="icon-star"></i><span>أولوية متوسطة</span>';
                priorityBadge.className = 'priority-badge medium';
            } else {
                priorityBadge.innerHTML = '<i class="icon-star"></i><span>أولوية قياسية</span>';
                priorityBadge.className = 'priority-badge low';
            }
            
            // إظهار المباني حسب الجنس
            if (studentData.gender === 'male') {
                document.getElementById('maleBuildings').style.display = 'block';
            } else {
                document.getElementById('femaleBuildings').style.display = 'block';
            }
            
            // اختيار المبنى
            const selectButtons = document.querySelectorAll('.btn-select-building');
            selectButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const building = this.getAttribute('data-building');
                    const gender = this.getAttribute('data-gender');
                    
                    // إخفاء جميع الأزرار النشطة
                    selectButtons.forEach(btn => btn.classList.remove('selected'));
                    
                    // تفعيل الزر المختار
                    this.classList.add('selected');
                    
                    // عرض تفاصيل المبنى المختار
                    const buildingCard = this.closest('.building-card');
                    const buildingName = buildingCard.querySelector('h3').textContent;
                    const buildingStatus = buildingCard.querySelector('.building-status').textContent;
                    const roomType = buildingCard.querySelectorAll('.building-info p')[0].textContent;
                    const capacity = buildingCard.querySelectorAll('.building-info p')[1].textContent;
                    const availability = buildingCard.querySelectorAll('.building-info p')[2].textContent;
                    
                    document.getElementById('selectedBuildingInfo').innerHTML = `
                        <h4>${buildingName}</h4>
                        <p><strong>الحالة:</strong> <span class="status-${buildingStatus.includes('متاح') ? 'available' : buildingStatus.includes('محدود') ? 'limited' : 'full'}">${buildingStatus}</span></p>
                        <p><strong>${roomType}</strong></p>
                        <p><strong>${capacity}</strong></p>
                        <p><strong>${availability}</strong></p>
                    `;
                    
                    // حفظ الاختيار مؤقتاً
                    localStorage.setItem('selectedBuilding', JSON.stringify({
                        building,
                        buildingName,
                        gender,
                        status: buildingStatus,
                        roomType,
                        capacity,
                        availability
                    }));
                    
                    // إظهار قسم التأكيد
                    document.getElementById('selectionConfirmation').style.display = 'block';
                });
            });
            
            // تأكيد الاختيار
            document.getElementById('confirmSelection').addEventListener('click', function() {
                const selectedBuilding = JSON.parse(localStorage.getItem('selectedBuilding'));
                
                if (!selectedBuilding) {
                    alert('الرجاء اختيار مبنى أولاً');
                    return;
                }
                
                // تحديث بيانات الطالب بالمبنى المختار
                const updatedStudent = {
                    ...studentData,
                    selectedBuilding: selectedBuilding.building,
                    buildingName: selectedBuilding.buildingName,
                    selectionDate: new Date().toISOString()
                };
                
                localStorage.setItem('currentStudent', JSON.stringify(updatedStudent));
                
                // الانتقال إلى صفحة النجاح
                window.location.href = 'success.html';
            });
            
            // تغيير الاختيار
            document.getElementById('changeSelection').addEventListener('click', function() {
                document.getElementById('selectionConfirmation').style.display = 'none';
                selectButtons.forEach(btn => btn.classList.remove('selected'));
            });
        });
        
        function calculatePriorityScore(gpa, province) {
            // خريطة المسافات (افتراضية)
            const distanceMap = {
                'نجران': 0,
                'الرياض': 85,
                'مكة المكرمة': 90,
                'المدينة المنورة': 88,
                'الشرقية': 95,
                'عسير': 30,
                'جازان': 65,
                'حائل': 75,
                'القصيم': 70,
                'تبوك': 80,
                'الجوف': 82,
                'الباحة': 40,
                'الحدود الشمالية': 89
            };
            
            const gpaScore = (gpa / 5) * 70; // 70% للمعدل
            const distanceScore = (distanceMap[province] || 50) * 0.3; // 30% للمسافة
            
            return Math.min(100, Math.round(gpaScore + distanceScore));
        }
    </script>
</body>
  </html>
