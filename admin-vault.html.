<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© - Ø¬Ø§Ù…Ø¹Ø© Ù†Ø¬Ø±Ø§Ù†</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/responsive.css">
    <style>
        .vault-container {
            padding: 20px;
        }
        
        .vault-header {
            background: linear-gradient(135deg, #1a5d1a, #2e8b57);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .vault-stats {
            display: flex;
            gap: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1a5d1a;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .vault-table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .vault-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .vault-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: right;
            border-bottom: 2px solid #dee2e6;
            color: #1a5d1a;
            font-weight: bold;
        }
        
        .vault-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .vault-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .vault-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .search-box {
            flex: 1;
            max-width: 300px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .search-box::before {
            content: "ğŸ”";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .priority-indicator {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .priority-high {
            background: #d4edda;
            color: #155724;
        }
        
        .priority-medium {
            background: #fff3cd;
            color: #856404;
        }
        
        .priority-low {
            background: #f8d7da;
            color: #721c24;
        }
        
        .empty-vault {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .empty-vault-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <header class="university-header">
        <div class="header-content">
            <h1>Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© - Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³ÙƒÙ†</h1>
            <p>Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³ÙƒÙ† Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ (50 Ø·Ù„Ø¨ ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)</p>
        </div>
    </header>

    <main class="container">
        <div class="vault-container">
            <div class="vault-header">
                <div>
                    <h2>ğŸ“ Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</h2>
                    <p>Ø¢Ø®Ø± 50 Ø·Ù„Ø¨ Ø³ÙƒÙ† ØªÙ… ØªØ³Ø¬ÙŠÙ„Ù‡Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                </div>
                <button onclick="logout()" class="logout-btn">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
            
            <div class="vault-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalApplications">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="maleCount">0</div>
                    <div class="stat-label">Ø·Ù„Ø§Ø¨ Ø°ÙƒÙˆØ±</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="femaleCount">0</div>
                    <div class="stat-label">Ø·Ø§Ù„Ø¨Ø§Øª Ø¥Ù†Ø§Ø«</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="avgGPA">0.00</div>
                    <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¹Ø¯Ù„</div>
                </div>
            </div>
            
            <div class="vault-actions">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©...">
                </div>
                <button onclick="exportToExcel()" class="export-btn">
                    ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                </button>
            </div>
            
            <div class="vault-table-container">
                <table class="vault-table" id="applicationsTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</th>
                            <th>Ø§Ù„Ù…Ø¹Ø¯Ù„</th>
                            <th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th>
                            <th>Ø§Ù„ØªØ®ØµØµ</th>
                            <th>Ø§Ù„Ø¬Ù†Ø³</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                            <th>Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                        </tr>
                    </thead>
                    <tbody id="applicationsTableBody">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                    </tbody>
                </table>
                
                <div id="emptyVault" class="empty-vault" style="display: none;">
                    <div class="empty-vault-icon">ğŸ“­</div>
                    <h3>Ø§Ù„Ø®Ø²Ù†Ø© ÙØ§Ø±ØºØ©</h3>
                    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø¹Ø¯</p>
                </div>
            </div>
            
            <div class="vault-info">
                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border: 1px solid #b3d7ff;">
                    <h3>ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ø²Ù†Ø©:</h3>
                    <ul>
                        <li><strong>Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ù‚ØµÙˆÙ‰:</strong> 50 Ø·Ù„Ø¨ ÙÙ‚Ø·</li>
                        <li><strong>Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:</strong> Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ØŒ ÙŠØ­Ø°Ù Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ù‚Ø¯Ù… Ø·Ù„Ø¨</li>
                        <li><strong>Ø§Ù„Ù…ÙØ§Ø¶Ù„Ø©:</strong> ØªØªÙ… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø¯Ù„ (70%) ÙˆØ§Ù„Ù…Ø³Ø§ÙØ© (30%)</li>
                        <li><strong>Ø§Ù„Ø­ÙØ¸:</strong> Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ localStorage Ù„Ù„Ù…ØªØµÙØ­</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>Â© 2024 Ø¬Ø§Ù…Ø¹Ø© Ù†Ø¬Ø±Ø§Ù† - Ø§Ù„Ø®Ø²Ù†Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ÙƒÙ†</p>
    </footer>

    <script src="js/vault.js"></script>
    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±
        if (!localStorage.getItem('adminLoggedIn')) {
            window.location.href = 'admin-login.html';
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            const vault = new StudentVault();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„
            updateVaultDisplay();
            
            // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙÙˆØ±ÙŠ
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filterApplications(e.target.value);
            });
            
            // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†Ù
            setInterval(updateVaultDisplay, 5000);
            
            function updateVaultDisplay() {
                const applications = vault.getAllApplications();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                updateStatistics(applications);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
                updateApplicationsTable(applications);
            }
            
            function updateStatistics(applications) {
                const total = applications.length;
                const maleCount = applications.filter(app => app.gender === 'Ø°ÙƒØ±').length;
                const femaleCount = total - maleCount;
                const avgGPA = total > 0 ? 
                    (applications.reduce((sum, app) => sum + parseFloat(app.gpa), 0) / total).toFixed(2) : 
                    '0.00';
                
                document.getElementById('totalApplications').textContent = total;
                document.getElementById('maleCount').textContent = maleCount;
                document.getElementById('femaleCount').textContent = femaleCount;
                document.getElementById('avgGPA').textContent = avgGPA;
            }
            
            function updateApplicationsTable(applications) {
                const tbody = document.getElementById('applicationsTableBody');
                const emptyDiv = document.getElementById('emptyVault');
                
                if (applications.length === 0) {
                    tbody.innerHTML = '';
                    emptyDiv.style.display = 'block';
                    return;
                }
                
                emptyDiv.style.display = 'none';
                
                // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© (Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹)
                applications.sort((a, b) => {
                    const priorityA = calculatePriority(a.gpa, a.province);
                    const priorityB = calculatePriority(b.gpa, b.province);
                    return priorityB - priorityA;
                });
                
                let html = '';
                
                applications.forEach((app, index) => {
                    const priority = calculatePriority(app.gpa, app.province);
                    const priorityClass = priority >= 70 ? 'priority-high' : 
                                         priority >= 50 ? 'priority-medium' : 
                                         'priority-low';
                    
                    html += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${app.fullName}</td>
                            <td>${app.nationalId}</td>
                            <td>${app.gpa}</td>
                            <td>${app.province}</td>
                            <td>${app.specialization}</td>
                            <td>${app.gender}</td>
                            <td>${new Date(app.registrationDate).toLocaleDateString('ar-SA')}</td>
                            <td>
                                <span class="priority-indicator ${priorityClass}">
                                    ${priority}%
                                </span>
                            </td>
                        </tr>
                    `;
                });
                
                tbody.innerHTML = html;
            }
            
            function filterApplications(searchTerm) {
                const vault = new StudentVault();
                let applications = vault.getAllApplications();
                
                if (searchTerm.trim()) {
                    const term = searchTerm.toLowerCase();
                    applications = applications.filter(app => 
                        app.fullName.toLowerCase().includes(term) ||
                        app.nationalId.includes(term) ||
                        app.specialization.toLowerCase().includes(term)
                    );
                }
                
                updateApplicationsTable(applications);
            }
            
            function calculatePriority(gpa, province) {
                // Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø³Ø§ÙØ§Øª (Ø§ÙØªØ±Ø§Ø¶ÙŠØ©)
                const distanceMap = {
                    'Ù†Ø¬Ø±Ø§Ù†': 0,
                    'Ø§Ù„Ø±ÙŠØ§Ø¶': 85,
                    'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©': 90,
                    'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©': 88,
                    'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©': 95,
                    'Ø¹Ø³ÙŠØ±': 30,
                    'Ø¬Ø§Ø²Ø§Ù†': 65,
                    'Ø­Ø§Ø¦Ù„': 75
                };
                
                const gpaScore = (parseFloat(gpa) / 5) * 70; // 70% Ù„Ù„Ù…Ø¹Ø¯Ù„
                const distanceScore = (distanceMap[province] || 50) * 0.3; // 30% Ù„Ù„Ù…Ø³Ø§ÙØ©
                
                return Math.min(100, Math.round(gpaScore + distanceScore));
            }
        });
        
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminLoginTime');
            window.location.href = 'admin-login.html';
        }
        
        function exportToExcel() {
            const vault = new StudentVault();
            const applications = vault.getAllApplications();
            
            if (applications.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ CSV
            let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
            
            // Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            csvContent += "Ø§Ù„Ø§Ø³Ù…,Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©,Ø§Ù„Ù…Ø¹Ø¯Ù„,Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©,Ø§Ù„ØªØ®ØµØµ,Ø§Ù„Ø¬Ù†Ø³,ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„,Ù†Ù‚Ø§Ø· Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©\n";
            
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            applications.forEach(app => {
                const priority = calculatePriority(app.gpa, app.province);
                const row = [
                    app.fullName,
                    app.nationalId,
                    app.gpa,
                    app.province,
                    app.specialization,
                    app.gender,
                    new Date(app.registrationDate).toLocaleDateString('ar-SA'),
                    priority
                ].map(field => `"${field}"`).join(',');
                
                csvContent += row + "\n";
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `Ø·Ù„Ø¨Ø§Øª_Ø§Ù„Ø³ÙƒÙ†_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            function calculatePriority(gpa, province) {
                const distanceMap = {
                    'Ù†Ø¬Ø±Ø§Ù†': 0,
                    'Ø§Ù„Ø±ÙŠØ§Ø¶': 85,
                    'Ù…ÙƒØ© Ø§Ù„Ù…ÙƒØ±Ù…Ø©': 90,
                    'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©': 88,
                    'Ø§Ù„Ø´Ø±Ù‚ÙŠØ©': 95,
                    'Ø¹Ø³ÙŠØ±': 30,
                    'Ø¬Ø§Ø²Ø§Ù†': 65,
                    'Ø­Ø§Ø¦Ù„': 75
                };
                
                const gpaScore = (parseFloat(gpa) / 5) * 70;
                const distanceScore = (distanceMap[province] || 50) * 0.3;
                return Math.min(100, Math.round(gpaScore + distanceScore));
            }
        }
    </script>
</body>
</html>
